<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Medico - Cr√©er un Conseil</title>
    <link rel="stylesheet" href="./mes-conseils.component.css">
</head>
<body>
    <header class="main_header">
        <div class="header_content">
            <h2>üè• Medico</h2>

        </div>
    </header>

    <div class="form-container">
        <h2>‚úçÔ∏è Cr√©er un nouveau conseil</h2>
        <p class="form-subtitle">Partagez vos connaissances en sant√© et bien-√™tre</p>

        <!-- Progress Steps -->
        <div class="progress-steps" [class.step-2]="currentStep === 2">
            <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
                <div class="step-circle">1</div>
                <div class="step-label">Informations de base</div>
            </div>
            <div class="step" [class.active]="currentStep === 2">
                <div class="step-circle">2</div>
                <div class="step-label">Contenu et publication</div>
            </div>
        </div>

        <!-- Alerts -->
        <div *ngIf="success" class="alert alert-success">
            {{ success }}
        </div>
        <div *ngIf="error" class="alert alert-error">
            {{ error }}
        </div>

        <form [formGroup]="conseilForm" (ngSubmit)="onSubmit()">
            
            <!-- ========================================
                 √âTAPE 1: Informations de base
                 ======================================== -->
            <div class="form-step" [class.active]="currentStep === 1" *ngIf="currentStep === 1">
                
                <!-- Titre -->
                <div class="form-group">
                    <label for="titre">Titre du conseil *</label>
                    <input 
                        type="text" 
                        id="titre" 
                        formControlName="titre"
                        placeholder="Ex: Comment pr√©venir les maladies cardiovasculaires"
                        [class.is-invalid]="submitted && f['titre'].errors"
                    />
                    <div class="invalid-feedback" *ngIf="submitted && f['titre'].errors">
                        <div *ngIf="f['titre'].errors['required']">Le titre est requis</div>
                        <div *ngIf="f['titre'].errors['minlength']">
                            Le titre doit contenir au moins 5 caract√®res
                        </div>
                    </div>
                </div>

                <!-- Auteur -->
                <div class="form-group">
                    <label for="auteur">Nom de l'auteur *</label>
                    <input 
                        type="text" 
                        id="auteur" 
                        formControlName="auteur"
                        placeholder="Ex: Dr. Marie Dupont"
                        [class.is-invalid]="submitted && f['auteur'].errors"
                    />
                    <div class="invalid-feedback" *ngIf="submitted && f['auteur'].errors">
                        <div *ngIf="f['auteur'].errors['required']">L'auteur est requis</div>
                    </div>
                </div>

                <div class="form-group">
                  <label for="contenu">Description *</label>
                  <textarea 
                      id="contenu"
                      formControlName="contenu"
                      placeholder="Veuillez saisir le contenu"
                      rows="4"
                      [class.is-invalid]="submitted && f['contenu'].errors"
                  ></textarea>
                  <div class="invalid-feedback" *ngIf="submitted && f['contenu'].errors">
                    <div *ngIf="f['contenu'].errors?.['required']">Le contenu est requis</div>
                    <div *ngIf="f['contenu'].errors?.['minlength']">Le contenu doit contenir au moins 50 caract√®res</div>
                  </div>
                </div>

                <!-- Cat√©gorie -->
                <div class="form-group">
                    <label for="categorie" >Cat√©gorie *</label>
                   <select 
                        id="categorie" 
                        formControlName="categorie"
                        [class.is-invalid]="submitted && f['categorie'].errors"
                    >
                        <option value="">S√©lectionner une cat√©gorie</option>
                        <option *ngFor="let cat of categories" [value]="cat.value">
                            {{ cat.icon }} {{ cat.label }}
                        </option>
                    </select>
                    <div class="invalid-feedback" *ngIf="submitted && f['categorie'].errors">
                        <div *ngIf="f['categorie'].errors['required']">La cat√©gorie est requise</div>
                    </div>
                </div>

                <!-- Image URL -->
                <div class="form-group">
                    <label for="imageUrl">URL de l'image (optionnel)</label>
                    <input 
                        type="url" 
                        id="imageUrl" 
                        formControlName="imageUrl"
                        placeholder="https://exemple.com/image.jpg"
                    />
                    <div class="image-preview" *ngIf="conseilForm.value.imageUrl">
                        <img [src]="conseilForm.value.imageUrl" alt="Aper√ßu" 
                             (error)="conseilForm.patchValue({imageUrl: ''})">
                    </div>
                </div>

                <!-- Actions Step 1 -->
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" (click)="onReset()">
                        üîÑ R√©initialiser
                    </button>
                    <button type="button" class="btn btn-primary" (click)="nextStep()">
                        Suivant ‚Üí
                    </button>
                </div>
            </div>

            <!-- ========================================
                 √âTAPE 2: Contenu et publication
                 ======================================== -->
            <div class="form-step" [class.active]="currentStep === 2" *ngIf="currentStep === 2">
                
                <!-- Contenu -->
                <div class="form-group">
                    <label for="contenu">Contenu du conseil *</label>
                    <textarea 
                        id="contenu" 
                        formControlName="contenu"
                        rows="10"
                        placeholder="R√©digez le contenu d√©taill√© de votre conseil (minimum 50 caract√®res)"
                        [class.is-invalid]="submitted && f['contenu'].errors"
                    ></textarea>
                    <div class="char-count" [style.color]="conseilForm.value.contenu?.length >= 50 ? '#28a745' : '#666'">
                        {{ conseilForm.value.contenu?.length || 0 }} / 50 caract√®res minimum
                    </div>
                    <div class="invalid-feedback" *ngIf="submitted && f['contenu'].errors">
                        <div *ngIf="f['contenu'].errors['required']">Le contenu est requis</div>
                        <div *ngIf="f['contenu'].errors['minlength']">
                            Le contenu doit contenir au moins 50 caract√®res
                        </div>
                    </div>
                </div>

                <!-- Tags -->
                <div class="form-group">
                    <label>Tags (mots-cl√©s)</label>
                    
                    <!-- Liste des tags -->
                    <div class="tags-container" formArrayName="tags">
                        <div class="tag-pill" *ngFor="let tag of tags.controls; let i = index">
                            <input 
                                type="text" 
                                [formControlName]="i" 
                                placeholder="Tag"
                                style="background: transparent; border: none; color: white; outline: none; width: auto; padding: 0;"
                            />
                            <button type="button" (click)="removeTag(i)">‚úï</button>
                        </div>
                    </div>
                    
                    <!-- Bouton ajouter tag -->
                    <button type="button" class="btn-add-tag" (click)="addTag()">
                        + Ajouter un tag
                    </button>
                </div>

                <!-- Publier imm√©diatement -->
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" formControlName="publie" />
                        <span>Publier imm√©diatement</span>
                    </label>
                </div>

                <!-- R√©sum√© -->
                <div class="summary-section">
                    <h3>üìã R√©sum√© de votre conseil</h3>
                    
                    <div class="summary-item">
                        <div class="summary-label">Titre:</div>
                        <div class="summary-value">{{ conseilForm.value.titre || '-' }}</div>
                    </div>
                    
                    <div class="summary-item">
                        <div class="summary-label">Auteur:</div>
                        <div class="summary-value">{{ conseilForm.value.auteur || '-' }}</div>
                    </div>

                    <div class="summary-item">
                      <div class="summary-label">Description:</div>
                      <div class="summary-value">{{ conseilForm.value.contenu || '-' }}</div>
                  </div>
                    
                    <div class="summary-item">
                        <div class="summary-label">Cat√©gorie:</div>
                        <div class="summary-value">{{ conseilForm.value.categorie || '-' }}</div>
                    </div>
                    
                    <div class="summary-item">
                        <div class="summary-label">Image:</div>
                        <div class="summary-value">
                            <img *ngIf="conseilForm.value.imageUrl"
                                 [src]="conseilForm.value.imageUrl"
                                 alt="Aper√ßu"
                                 style="width:150px; height:auto; border-radius:8px;">
                            <span *ngIf="!conseilForm.value.imageUrl">Aucune image</span>
                        </div>
                    </div>

                    <div class="summary-item">
                        <div class="summary-label">Tags:</div>
                        <div class="summary-value">
                            <span *ngIf="tags.length === 0">Aucun tag</span>
                            <span *ngIf="tags.length > 0">{{ tags.length }} tag(s)</span>
                        </div>
                    </div>

                    <div class="summary-item">
                        <div class="summary-label">Publication:</div>
                        <div class="summary-value">
                            {{ conseilForm.value.publie ? 'Imm√©diate' : 'Brouillon' }}
                        </div>
                    </div>
                </div>

                <!-- Actions Step 2 -->
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" (click)="prevStep()">
                        ‚Üê Pr√©c√©dent
                    </button>
                    <button type="submit" class="btn btn-primary" [disabled]="loading">
                        <span *ngIf="!loading">‚ú® Cr√©er le conseil</span>
                        <span *ngIf="loading">‚è≥ Cr√©ation en cours...</span>
                    </button>
                </div>
            </div>
        </form>
    </div>
</body>
</html>