<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Medico - Espace Patient</title>
  </head>

  <body>
    <!-- Section de notification d'alerte -->
    <div *ngIf="showAlert" class="notification-alert" [ngClass]="'alert-' + alertType">
      <div class="alert-content">
        <span class="alert-icon">
          <ng-container [ngSwitch]="alertType">
            <span *ngSwitchCase="'success'">‚úì</span>
            <span *ngSwitchCase="'error'">‚úï</span>
            <span *ngSwitchCase="'info'">‚Ñπ</span>
          </ng-container>
        </span>
        <span class="alert-message">{{ alertMessage }}</span>
        <button class="alert-close" (click)="hideNotification()">√ó</button>
      </div>
    </div>

    <!-- Header avec Messagerie -->
    <div class="header">
      <div class="logo">
        <div class="logo-icon">+</div>
        <div class="logo-text">Medico</div>
      </div>

      <!-- Section Actions Utilisateur avec Messagerie -->
      <div class="user-actions">
        <!-- Ic√¥ne de messagerie -->
        <div class="message-icon-container" (click)="toggleMessagesPanel()">
          <div class="message-icon">
            üí¨
            <span class="message-badge" *ngIf="unreadMessagesCount > 0">
              {{ unreadMessagesCount }}
            </span>
          </div>
        </div>

        <!-- Profil utilisateur -->
        <div class="user-profile" (click)="toggleMenu()">
          <div class="img-profile">
            <div class="dropdown-menu" [class.show]="menuOpen">
              <button class="logout" (click)="logout()">D√©connexion</button>
            </div>
            üë§ {{ userName }}
          </div>
        </div>
      </div>
    </div>

    <!-- Panneau des messages -->
    <div class="messages-panel" [class.show]="showMessagesPanel && !showMessageDetail">
      <div class="messages-header">
        <h3>Messages</h3>
        <div class="messages-actions">
          <button 
            class="mark-all-read-btn" 
            *ngIf="unreadMessagesCount > 0"
            (click)="markAllAsRead()"
            title="Marquer tout comme lu">
            ‚úì
          </button>
          <button class="close-panel-btn" (click)="toggleMessagesPanel()">√ó</button>
        </div>
      </div>

      <div class="messages-list" *ngIf="appointmentNotifications.length > 0">
        <div 
          *ngFor="let appointmentNotification of appointmentNotifications" 
          class="message-item"
          [class.unread]="!appointmentNotification.read"
          (click)="openMessage(appointmentNotification)">
          
          <div class="message-icon-type">{{ getMessageIcon(appointmentNotification.type) }}</div>
          
          <div class="message-content">
            <div class="message-header-row">
              <span class="message-sender">{{ appointmentNotification.sender }}</span>
              <span class="message-date">{{ appointmentNotification.date }}</span>
            </div>
            <div class="message-subject">{{ appointmentNotification.subject }}</div>
            <div class="message-preview">{{ appointmentNotification.content | slice:0:60 }}...</div>
          </div>

          <button 
            class="delete-message-btn" 
            (click)="deleteMessage(appointmentNotification.id, $event)"
            title="Supprimer">
            üóëÔ∏è
          </button>
        </div>
      </div>

      <div class="messages-empty" *ngIf="appointmentNotifications.length === 0">
        <div class="empty-icon">üì≠</div>
        <p>Aucun message</p>
      </div>
    </div>

    <!-- D√©tail du message -->
    <div class="message-detail-panel" [class.show]="showMessageDetail" *ngIf="selectedMessage">
      <div class="message-detail-header">
        <button class="back-btn" (click)="closeMessageDetail()">‚Üê Retour</button>
        <button class="delete-btn" (click)="deleteMessage(selectedMessage.id)">üóëÔ∏è Supprimer</button>
      </div>

      <div class="message-detail-content">
        <div class="detail-icon">{{ getMessageIcon(selectedMessage.type) }}</div>
        <h2>{{ selectedMessage.subject }}</h2>
        
        <div class="message-meta">
          <span class="sender-name">De: {{ selectedMessage.sender }}</span>
          <span class="message-date-detail">{{ selectedMessage.date }}</span>
        </div>

        <div class="message-body">
          <p>{{ selectedMessage.content }}</p>
        </div>
      </div>
    </div>

    <!-- Overlay pour fermer les panneaux -->
    <div 
      class="messages-overlay" 
      *ngIf="showMessagesPanel || showMessageDetail"
      (click)="showMessagesPanel = false; showMessageDetail = false">
    </div>

    <!-- Navigation -->
    <div class="nav">
      <ul class="nav-items">
        <li>
          <a href="#" [class.active]="isSectionActive('dashboard')" 
             (click)="showSection('dashboard', $event)">Tableau de bord</a>
        </li>
        <li>
          <a href="#" [class.active]="isSectionActive('services')" 
             (click)="showSection('services', $event)">Services</a>
        </li>
        <li>
          <a href="#" [class.active]="isSectionActive('appointments')" 
             (click)="showSection('appointments', $event)">Mes rendez-vous</a>
        </li>
        <li>
          <a href="#" [class.active]="isSectionActive('advice')" 
             (click)="showSection('advice', $event)">Conseils</a>
        </li>
        <li>
          <a href="#" [class.active]="isSectionActive('medical-file')" 
             (click)="showSection('medical-file', $event)">Dossier m√©dical</a>
        </li>
      </ul>
    </div>

    <div class="main-content">
      <!-- Dashboard content -->
      <div id="dashboard-content" [style.display]="isSectionActive('dashboard') ? 'block' : 'none'">
        <div class="welcome-section">
          <div class="welcome-text">
            <p>Bienvenue <strong>{{ userName }}</strong></p>
            <p>Bienvenue dans votre espace de sant√© personnel et s√©curis√©</p>
            <button class="appointment-btn" (click)="showSection('forms-file', $event)">
              Prendre un rendez-vous
            </button>
          </div>
        </div>

        <div class="dashboard-cards">
          <div class="card">
            <div class="card-icon"><i>üìÖ</i></div>
            <h3>Rendez-vous</h3>
            <p>Prochain RDV: 12 Mai</p>
            <p>Dr. Martin - G√©n√©raliste</p>
          </div>

          <div class="card">
            <div class="card-icon"><i>üíä</i></div>
            <h3>Mes m√©dicaments</h3>
            <p>2 prescriptions actives</p>
            <p>Derni√®re mise √† jour: 30 avril</p>
          </div>

          <div class="card">
            <div class="card-icon"><i>üìã</i></div>
            <h3>R√©sultats</h3>
            <p>3 analyses r√©centes</p>
            <p>Voir mes r√©sultats</p>
          </div>

          <div class="card">
            <div class="card-icon"><i>üìù</i></div>
            <h3>Suivi sant√©</h3>
            <p>Mises √† jour r√©guli√®res</p>
            <p>Ajouter des donn√©es</p>
          </div>
        </div>
      </div>

      <!-- Services content -->
      <div id="services-content" [style.display]="isSectionActive('services') ? 'block' : 'none'">
        <div class="welcome-section">
          <div class="welcome-text">
            <p>Nos services m√©dicaux</p>
            <p>D√©couvrez l'ensemble des services propos√©s par notre plateforme</p>
          </div>
        </div>

        <div class="service-categories">
          <div class="service-category">
            <h3>Consultations</h3>
            <p>Consultations en pr√©sentiel ou en t√©l√©consultation</p>
          </div>
          <div class="service-category">
            <h3>Pr√©vention</h3>
            <p>Bilans de sant√© et d√©pistages pr√©ventifs</p>
          </div>
          <div class="service-category">
            <h3>Soins sp√©cialis√©s</h3>
            <p>Acc√®s √† un r√©seau de sp√©cialistes</p>
          </div>
        </div>

        <div class="service-list">
          <div class="service-item">
            <div class="service-icon">üë®‚Äç‚öïÔ∏è</div>
            <div class="service-details">
              <h4>Consultation m√©dicale</h4>
              <p>Consultation avec un m√©decin g√©n√©raliste pour tout probl√®me de sant√©.</p>
              <button class="service-btn" (click)="showSection('forms-file', $event)">Prendre rendez-vous</button>
            </div>
          </div>

          <div class="service-item">
            <div class="service-icon">üñ•Ô∏è</div>
            <div class="service-details">
              <h4>T√©l√©consultation</h4>
              <p>Consultation vid√©o avec un professionnel de sant√© sans vous d√©placer.</p>
              <button class="service-btn">D√©marrer une t√©l√©consultation</button>
            </div>
          </div>

          <div class="service-item">
            <div class="service-icon">üíâ</div>
            <div class="service-details">
              <h4>Vaccination</h4>
              <p>Service de vaccination pour adultes et enfants.</p>
              <button class="service-btn">Voir les disponibilit√©s</button>
            </div>
          </div>

          <div class="service-item">
            <div class="service-icon">üß†</div>
            <div class="service-details">
              <h4>Suivi psychologique</h4>
              <p>Consultations avec des psychologues qualifi√©s.</p>
              <button class="service-btn">En savoir plus</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Appointments content -->
      <div id="appointments-content" [style.display]="isSectionActive('appointments') ? 'block' : 'none'">
        <div class="welcome-section">
          <div class="welcome-text">
            <p>Mes rendez-vous</p>
            <p>Consultez et g√©rez l'ensemble de vos rendez-vous m√©dicaux</p>
            <button class="appointment-btn" (click)="showSection('forms-file', $event)">
              Nouveau rendez-vous
            </button>
          </div>
        </div>

        <div class="service-list" *ngFor="let app of this.tableauClasse">
          <div class="service-item">
            <div class="service-icon">üìÖ</div>
            <div class="service-details">
              <h4>INFORMATIONS</h4>
              <p><strong>Date:</strong> {{ app.preferredDate }} √† {{ app.preferredTime }}</p>
              <p><strong>Rendez-vous :</strong>{{ app.reason }}</p>
              <p><strong>Raison </strong>{{app.symptoms}}</p>
              <p><strong>Information additionnel </strong>{{app.additionalInfo}}</p>
              <p><strong>Statut:</strong> {{ app.status }}</p>
              <div style="display: flex; gap: 10px">
                <button class="service-btn" >Modifier</button>
                <button class="service-btn" style="background-color: #f44336" (click)="deleteAppointement(app.id)">Annuler</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Advice content -->
      <div id="advice-content" [style.display]="isSectionActive('advice') ? 'block' : 'none'">
        <div class="welcome-section">
          <div class="welcome-text">
            <p>Conseils sant√©</p>
            <p>Retrouvez des conseils personnalis√©s pour maintenir votre sant√©</p>
          </div>
        </div>
        <app-conseil></app-conseil>
      </div>

      <!-- Medical File content -->
      <div id="medical-file-content" [style.display]="isSectionActive('medical-file') ? 'block' : 'none'">
        <div class="welcome-section">
          <div class="welcome-text">
            <p>Mon dossier m√©dical</p>
            <p>Acc√©dez √† vos informations m√©dicales en toute s√©curit√©</p>
            <button class="appointment-btn" (click)="downloadCompleteMedicalFile()">
              üì• T√©l√©charger mon dossier complet
            </button>
          </div>
        </div>

        <div class="service-categories">
          <div class="service-category">
            <h3>Ant√©c√©dents</h3>
            <p>Historique m√©dical complet</p>
          </div>
          <div class="service-category">
            <h3>Analyses</h3>
            <p>R√©sultats d'examens r√©cents</p>
          </div>
          <div class="service-category">
            <h3>Traitements</h3>
            <p>M√©dicaments et prescriptions</p>
          </div>
          <div class="service-category">
            <h3>Allergies</h3>
            <p>Allergies et intol√©rances</p>
          </div>
        </div>

        <div class="service-list">
          <h3>Derniers documents m√©dicaux</h3>
          <div class="service-item" *ngFor="let file of medicalFiles">
            <div class="service-icon">{{ file.icon }}</div>
            <div class="service-details">
              <h4>{{ file.title }}</h4>
              <p><strong>Date:</strong> {{ file.date }}</p>
              <p><strong>{{ file.type }}:</strong> {{ file.location }}</p>
              <button class="service-btn" (click)="openMedicalFile(file.id)">
                üëÅÔ∏è Consulter
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Popup pour fichiers m√©dicaux -->
      <div class="popup-overlay" *ngIf="showMedicalFilePopup" (click)="closeMedicalFilePopup()">
        <div class="popup-modal" (click)="$event.stopPropagation()">
          <div class="popup-header">
            <h2>{{ selectedMedicalFile?.title }}</h2>
            <button class="popup-close" (click)="closeMedicalFilePopup()">&times;</button>
          </div>
          <div class="popup-content" [innerHTML]="selectedMedicalFile?.details"></div>
          <div class="popup-footer">
            <button class="service-btn" 
                    (click)="downloadMedicalFile(selectedMedicalFile?.fileUrl, selectedMedicalFile?.title)"
                    style="margin-right: 10px">
              üì• T√©l√©charger
            </button>
            <button class="service-btn" (click)="printMedicalFile()" style="margin-right: 10px">
              üñ®Ô∏è Imprimer
            </button>
            <button class="popup-btn-close" (click)="closeMedicalFilePopup()">Fermer</button>j
          </div>
        </div>
      </div>

      <!-- Formulaire de rendez-vous -->
      <div id="forms-file-content" [style.display]="isSectionActive('forms-file') ? 'block' : 'none'">
        <div class="welcome-text">
          <app-appoint></app-appoint>
        </div>
      </div>
    </div>
  </body>
</html>